'use client'

import { useState } from 'react'
import { BarChart3, TrendingUp, Users, Target, DollarSign } from 'lucide-react'
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { formatCurrency } from '@/lib/utils'

// Import data directly (generated by agent)
import { CASE_STUDIES } from '@/data/cases'
import { BENCHMARKS, VALIDATED_NICHES } from '@/data/benchmarks'

export default function BenchmarksPage() {
  const [selectedNiche, setSelectedNiche] = useState<string | null>(null)

  const filteredCases = selectedNiche
    ? CASE_STUDIES.filter((c) => c.niche.toLowerCase().includes(selectedNiche.toLowerCase()))
    : CASE_STUDIES

  // Group benchmarks by category
  const benchmarksByMetric = BENCHMARKS.reduce((acc, b) => {
    const key = b.metric.split(' ')[0] || 'Outros'
    if (!acc[key]) acc[key] = []
    acc[key].push(b)
    return acc
  }, {} as Record<string, typeof BENCHMARKS>)

  return (
    <div className="space-y-6">
      <Tabs defaultValue="cases">
        <TabsList>
          <TabsTrigger value="cases">Cases Reais</TabsTrigger>
          <TabsTrigger value="benchmarks">Benchmarks</TabsTrigger>
          <TabsTrigger value="nichos">Nichos Validados</TabsTrigger>
        </TabsList>

        {/* Cases */}
        <TabsContent value="cases">
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {filteredCases.map((cs) => (
              <Card key={cs.id} className="hover:border-primary/30 transition-colors">
                <CardHeader>
                  <div className="flex items-center justify-between">
                    <CardTitle className="text-base">{cs.name}</CardTitle>
                    {cs.roas > 0 && (
                      <Badge variant={cs.roas >= 10 ? 'success' : cs.roas >= 5 ? 'default' : 'warning'}>
                        {cs.roas.toFixed(1)}x ROAS
                      </Badge>
                    )}
                  </div>
                  <CardDescription>{cs.niche}</CardDescription>
                </CardHeader>
                <CardContent>
                  <div className="grid grid-cols-2 gap-3 text-sm">
                    {cs.investment > 0 && (
                      <div>
                        <p className="text-muted-foreground">Investimento</p>
                        <p className="font-medium">{formatCurrency(cs.investment)}</p>
                      </div>
                    )}
                    {cs.revenue > 0 && (
                      <div>
                        <p className="text-muted-foreground">Faturamento</p>
                        <p className="font-medium text-success">{formatCurrency(cs.revenue)}</p>
                      </div>
                    )}
                    {cs.tickets > 0 && (
                      <div>
                        <p className="text-muted-foreground">Ingressos</p>
                        <p className="font-medium">{cs.tickets.toLocaleString('pt-BR')}</p>
                      </div>
                    )}
                    {cs.conversion > 0 && (
                      <div>
                        <p className="text-muted-foreground">Conversão</p>
                        <p className="font-medium">{cs.conversion}%</p>
                      </div>
                    )}
                    {cs.cpa > 0 && (
                      <div>
                        <p className="text-muted-foreground">CPA</p>
                        <p className="font-medium">{formatCurrency(cs.cpa)}</p>
                      </div>
                    )}
                    {cs.ticketPrice > 0 && (
                      <div>
                        <p className="text-muted-foreground">Ticket</p>
                        <p className="font-medium">{formatCurrency(cs.ticketPrice)}</p>
                      </div>
                    )}
                  </div>
                  {cs.highlights.length > 0 && (
                    <div className="mt-3 pt-3 border-t">
                      <ul className="space-y-1">
                        {cs.highlights.slice(0, 3).map((h, i) => (
                          <li key={i} className="text-xs text-muted-foreground flex items-start gap-1">
                            <span className="text-primary mt-0.5">•</span>
                            {h}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </CardContent>
              </Card>
            ))}
          </div>
        </TabsContent>

        {/* Benchmarks */}
        <TabsContent value="benchmarks">
          <div className="grid gap-4 md:grid-cols-2">
            {Object.entries(benchmarksByMetric).slice(0, 10).map(([category, items]) => (
              <Card key={category}>
                <CardHeader>
                  <CardTitle className="text-base capitalize">{category}</CardTitle>
                </CardHeader>
                <CardContent>
                  <div className="space-y-2">
                    {items.slice(0, 8).map((b) => (
                      <div key={b.id} className="flex items-center justify-between text-sm">
                        <span className="text-muted-foreground">{b.metric}</span>
                        <span className="font-medium">
                          {b.unit === 'R$' ? formatCurrency(b.value) : b.unit === '%' ? `${b.value}%` : `${b.value}${b.unit}`}
                        </span>
                      </div>
                    ))}
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </TabsContent>

        {/* Nichos */}
        <TabsContent value="nichos">
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
            {VALIDATED_NICHES.map((niche) => (
              <Card key={niche.niche} className="hover:border-primary/30 transition-colors">
                <CardContent className="pt-6">
                  <div className="flex items-start gap-3">
                    <div className="rounded-lg bg-primary/10 p-2">
                      <Target className="h-4 w-4 text-primary" />
                    </div>
                    <div>
                      <p className="font-medium">{niche.niche}</p>
                      <p className="text-sm text-muted-foreground mt-1">{niche.caseName}</p>
                      <p className="text-xs text-muted-foreground mt-0.5">{niche.result}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))}
          </div>
        </TabsContent>
      </Tabs>
    </div>
  )
}
